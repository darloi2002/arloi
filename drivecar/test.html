<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #thefile {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
        }
        
        #canvas {
            left: 0;
            top: 0;
            width: 1000px;
            height: 100%;
        }
        
        audio {
            left: 10px;
            bottom: 10px;
            width: calc(100% - 20px);
        }
    </style>
</head>

<body>
    <div id="content">
        <canvas id="canvas"></canvas>
        <audio src="song/tinhcatinhta.mp3" id="audio" controls></audio>
    </div>
</body>


<script>
    window.onload = function() {

        var audio = document.getElementById("audio");

        addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                audio.play();
                var context = new AudioContext();

                var src = context.createMediaElementSource(audio);
                var analyser = context.createAnalyser();

                var canvas = document.getElementById("canvas");
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                var ctx = canvas.getContext("2d");

                src.connect(analyser);
                analyser.connect(context.destination);

                analyser.fftSize = 256;

                var bufferLength = analyser.frequencyBinCount / 4;
                console.log(bufferLength);

                var dataArray = new Uint8Array(bufferLength);

                var WIDTH = canvas.width;
                var HEIGHT = canvas.height;

                var barWidth = (WIDTH / bufferLength);
                var barHeight;
                var x = 0;

                function renderFrame() {
                    requestAnimationFrame(renderFrame);

                    x = 0;

                    analyser.getByteFrequencyData(dataArray);

                    ctx.fillStyle = "#fff";
                    ctx.fillRect(0, 0, WIDTH, HEIGHT);

                    for (var i = 0; i < bufferLength; i++) {
                        barHeight = dataArray[i];

                        var r = barHeight + (25 * (i / bufferLength));
                        var g = 250 * (i / bufferLength);
                        var b = 50;

                        ctx.fillStyle = "rgb(" + r + "," + g + "," + b + ")";
                        ctx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);

                        x += barWidth + 1;
                    }
                }



                audio.play();
                renderFrame();
            }
        })


    };
</script>

</html>